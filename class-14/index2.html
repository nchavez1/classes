<!DOCTYPE html>
<meta charset='utf-8'>
<title>US Counties</title>
<style>
body {
  margin: 0;
  background-color: #eee;
}

.info {
  position: absolute;
  top: 50px;
  left: 50px;
}
</style>
<body>
<div class="info"></div>
<svg width="960" height="500" fill="none" stroke-linejoin="round" stroke-linecap="round"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://unpkg.com/topojson-client@3"></script>
<script>

// This demo modified slightly from https://bl.ocks.org/mbostock/4108203
var svg = d3.select("svg").append("g");

var width = svg.node().width, height = svg.node().height;

// New York central state plane, EPSG: 2829
// (central meridian = - 76.5833..., latitute of origin = 40)
var projection = d3.geoTransverseMercator()
        .rotate([76 + 35 / 60, - 40]);

var path = d3.geoPath()
    .projection(projection);

var path = d3.geoPath()
    .projection(projection);

d3.queue()
    .defer(d3.json,"counties.json")
    .defer(d3.json,"population.json")
    .await(ready);

function ready(error, us, population) {
  if (error) throw error;

  console.log('here is population[0]:', population[0]);
  console.log('here is population[1]:', population[1]);
  console.log('here is the topojson data:', us.objects);

  var conus = topojson.merge(us, us.objects.counties.geometries);
  console.log('conus', conus)

  // Get NY counties as array of GeoJSON objects
  var newyork = us.objects.counties.geometries.filter(function(d) { return d.properties.STATEFP === '36' })
  newyork = topojson.feature(us, { type: "GeometryCollection", geometries: newyork });

  var fips = d3.set(us.objects.counties.geometries.map(function(d) { return d.properties.STATEFP; })).values();
  console.log('These are the state FIPS', fips);

  // Create states by merging counties
  var states = fips.map(function(fips) {
    var geoms = us.objects.counties.geometries.filter(function(d) { return d.properties.STATEFP === fips })
    return topojson.merge(us, geoms);
  });
  console.log('here is states[0]', states[0])

  projection.fitExtent([[0, 0],[960, 500]], newyork)

  // Examine one of the counties in the developer console.
  // The "id" attribute is a 5-digit GEOID (state + county).
  // See: https://www.census.gov/geo/reference/geoidentifiers.html
  console.log('here is a new york county:', newyork.features[0]);

  // Draw the counties
  svg.selectAll('path.county')
      .data( newyork.features )
    .enter().append("path")
      .attr("d", path)
      .attr('fill', '#fff')
      .attr("stroke", "#aaa")
      .attr("stroke-width", 0.5)
      .on('mouseover', function(d, i) {
        d3.select(this).attr('fill', 'crimson');
        d3.select(".info").html(d.properties.NAME)
        console.log('mouseover:', i, d);
      })
      .on('mouseout', function(d) {
        d3.select(this).attr('fill', '#fff');
        d3.select(".info").html("")
      });

  // Draw the states
  svg.append("g")
      .attr('fill-opacity', 0)
      .attr("stroke", "#000")
      .attr("stroke-width", 1)
      .attr("pointer-events", "none")
    .selectAll('path.state')
      .data( states )
    .enter().append("path")
      .attr("d", path)

  // Draw the continental US
  svg.append("path")
      .attr("d", path(conus))
      .attr("fill", "none")
      .attr("stroke", "#000")
      .attr("stroke-width", 2)
      .attr("pointer-events", "none");
}

</script>
